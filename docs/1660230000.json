{
  "title":"async/awaitを使わずに音声を連続再生してみる",
  "description":"",
  "date":"2022/08/24",
  "paragraph":["0$h3","1$p","2$h3","3$h4","4$pre","5$h4","6$pre","7$h3","8$p","9$iframe"],
  "0$h3":"概要",
  "1$p":"JavaScriptで音声パーツを組み合わせて文章を生成・再生する機能を実装していた時にasyncやawaitといった非同期処理の存在を知ったが、勉強が面倒だったのでイベントリスナーを用いて実装してみた。",
  "2$h3":"ソースコード",
  "3$h4":"JavaScript",
  "4$pre":"<code><span class='code_prev_pi'>let</span> <span class='code_prev_pu'>playing</span> = <span class='code_prev_pi'>false</span>;<br><span class='code_prev_pi'>let</span> <span class='code_prev_pu'>que_count</span>;<br><span class='code_prev_pi'>const</span> <span class='code_prev_pu'>que</span> = [<span class='code_prev_comment'>filepath1</span>,<span class='code_prev_comment'>filepath2</span>,<span class='code_prev_comment'>filepath3</span>,<span class='code_prev_comment'>...</span>];<br><br><span class='code_prev_pi'>function</span> <span class='code_prev_bl'>audioplay</span>(<span class='code_prev_bl'>mode</span>){<br>&nbsp;&nbsp;<span class='code_prev_comment'>//再生中のボタン押下による二重起動を防止</span><br>&nbsp;&nbsp;<span class='code_prev_pi'>if</span>(<span class='code_prev_pu'>playing</span> === <span class='code_prev_pi'>false</span> <span class='code_prev_pu'>||</span> <span class='code_prev_bl'>mode</span> !== <span class='code_prev_db'>&#39;start&#39;</span>){<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>const</span> <span class='code_prev_bl'>sound</span> = <span class='code_prev_pu'>document</span>.<span class='code_prev_gr'>getElementById</span>(<span class='code_prev_db'>&#39;player&#39;</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>if</span>(<span class='code_prev_bl'>mode</span> === <span class='code_prev_db'>&#39;start&#39;</span>){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pu'>playing</span> = <span class='code_prev_pi'>true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pu'>que_count</span> = <span class='code_prev_db'>0</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>if</span>(<span class='code_prev_pu'>que_count</span> < <span class='code_prev_pu'>que</span>.<span class='code_prev_gr'>length</span>){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_bl'>sound</span>.<span class='code_prev_gr'>src</span> = <span class='code_prev_pu'>que</span>[<span class='code_prev_pu'>que_count</span>];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_bl'>sound</span>.<span class='code_prev_gr'>play</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>if</span>(<span class='code_prev_pu'>que_count</span> === <span class='code_prev_db'>0</span>){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_bl'>sound</span>.<span class='code_prev_gr'>addEventListener</span>(<span class='code_prev_bl'>&#39;ended&#39;</span>,<span class='code_prev_pu'>audioplay</span>,<span class='code_prev_pi'>false</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<span class='code_prev_pi'>else if</span>(<span class='code_prev_pu'>que_count</span> === <span class='code_prev_pu'>que</span>.<span class='code_prev_gr'>length</span>){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_comment'>//最後のパーツを再生し終わったらイベントリスナー解除</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_bl'>sound</span>.<span class='code_prev_gr'>removeEventListener</span>(<span class='code_prev_bl'>&#39;ended&#39;</span>,<span class='code_prev_pu'>audioplay</span>,<span class='code_prev_pi'>false</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pu'>playing</span> = <span class='code_prev_pi'>false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pu'>que_count</span>++;<br>&nbsp;&nbsp;}<br>}</code>",
  "5$h4":"HTML",
  "6$pre":"<code>&lt;!DOCTYPE html&gt;<br><span class='code_prev_bl'>&lt;html&gt;</span><br><span class='code_prev_comment'>&lt;head&gt;<br>&nbsp;&nbsp;&lt;meta charset=&quot;UTF-8&quot;&gt;<br>&nbsp;&nbsp;&lt;script src=&quot;script.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;<br>&lt;/head&gt;</span><br><span class=code_prev_bl>&lt;body&gt;<br>&nbsp;&nbsp&lt;audio</span> <span class='code_prev_pi'>id</span>=&quot;<span class='code_prev_pu'>player</span>&quot; <span class='code_prev_pi'>controls</span><span class='code_prev_bl'>&gt;&lt;/audio&gt;<br>&nbsp;&nbsp;&lt;input</span> <span class='code_prev_pi'>type</span>=<span class='code_prev_pu'>&quot;button&quot;</span> <span class='code_prev_pi'>value</span>=<span class='code_prev_pu'>&quot;再生開始&quot;</span> <span class='code_prev_pi'>onclick</span>=&quot;<span class='code_prev_pu'>audioplay('start');</span>&quot;<span class='code_prev_bl'>&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;</span>",
  "7$h3":"サンプル",
  "8$p":"3つのmp3ファイルを連続再生するサンプル",
  "9$iframe":"docs/1660230000/demo.html"
}
