{
  "title":"東進の向上得点の履歴・来校履歴をCSV形式で取得する",
  "description":"",
  "date":"2022/11/12",
  "paragraph":["0$h3","1$p","2$div$info_warn","3$h3","4$p","5$h3","6$h4","7$pre","8$h4","9$pre","10$h3","11$h4","12$p","13$h4","14$p"],
  "0$h3":"概要",
  "1$p":"東進学力POSで確認できる向上得点の履歴<del>と来校履歴</del>をCSV形式で取得するスクリプト。受験勉強の記録を残しておきたい人はどうぞ。",
  "2$div$info_warn":"このページは2022年に途中まで書いて放置状態だったページをそのまま公開したものです。<br>後述の通り、<strong>コード紛失により登下校記録のコードは掲載していません。</strong><br>また、掲載しているスクリプトは学力POSの仕様変更等により現在は使用出来ない可能性があります。",
  "3$h3":"使い方",
  "4$p":"1. 東進学力POS(pos.toshin.com)のページを開いた状態で開発ツールを起動し、以下のソースコードを貼り付ける。<br>2. コンソールにデータが出力されるので、コピーしてメモ帳などに貼り付け、CSV形式で保存する。",
  "5$h3":"ソースコード",
  "6$h4":"向上得点の履歴を取得",
  "7$pre":"<code>(<span class='code_prev_pi'>function</span>(){<br>&nbsp;&nbsp;<span class='code_prev_pu'>fetch</span>(<span class='code_prev_db'>'https://pos.toshin.com/SPS3/SPS_Student/Handler/RMInfoHandler.ashx?DispRowsNum=10&SelectedPageNum=1'</span>)<br>&nbsp;&nbsp;.<span class='code_prev_gr'>then</span>(<span class='code_prev_bl'>response</span> => {<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>return</span> <span class='code_prev_bl'>response</span>.<span class='code_prev_gr'>json</span>();<br>&nbsp;&nbsp;})<br>&nbsp;&nbsp;.<span class='code_prev_gr'>then</span>(<span class='code_prev_bl'>data</span> => {<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>const</span> <span class='code_prev_bl'>rows</span> = <span class='code_prev_bl'>data</span>.<span class='code_prev_gr'>table1</span>[<span class='code_prev_db'>0</span>].<span class='code_prev_gr'>TOTAL_ROW_COUNT</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pu'>getRMInfo</span>(<span class='code_prev_bl'>rows</span>);<br>&nbsp;&nbsp;});<br>})();<br><span class='code_prev_pi'>function</span> <span class='code_prev_bl'>getRMInfo</span>(<span class='code_prev_bl'>rows</span>){<br>&nbsp;&nbsp;<span class='code_prev_pi'>const</span> <span class='code_prev_bl'>path</span> = <span class='code_prev_db'>'https://pos.toshin.com/SPS3/SPS_Student/Handler/RMInfoHandler.ashx?DispRowsNum='</span> + <span class='code_prev_bl'>rows</span> + <span class='code_prev_db'>'&SelectedPageNum=1'</span>;<br>&nbsp;&nbsp;<span class='code_prev_pu'>fetch</span>(<span class='code_prev_bl'>path</span>);<br>&nbsp;&nbsp;.<span class='code_prev_gr'>then</span>(<span class='code_prev_bl'>response</span> => {<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>return</span> <span class='code_prev_bl'>response</span>.<span class='code_prev_gr'>json</span>();<br>&nbsp;&nbsp;})<br>&nbsp;&nbsp;.<span class='code_prev_gr'>then</span>(<span class='code_prev_bl'>data</span> => {<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>const</span> <span class='code_prev_bl'>currentdate</span> = <span class='code_prev_pi'>new</span> <span class='code_prev_pu'>Date</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>let</span> <span class='code_prev_bl'>resultCSV</span> = <span class='code_prev_db'>'取得日時:'</span> + <span class='code_prev_bl'>currentdate</span>.<span class='code_prev_gr'>getFullYear</span>() + <span class='code_prev_db'>'/'</span> + (<span class='code_prev_bl'>currentdate</span>.<span class='code_prev_gr'>getMonth</span>()+<span class='code_prev_db'>1</span>) + <span class='code_prev_db'>'/'</span> + <span class='code_prev_bl'>currentdate</span>.<span class='code_prev_gr'>getDate</span>() + <span class='code_prev_db'>'&nbsp;全'</span> + <span class='code_prev_bl'>rows</span> + <span class='code_prev_db'>'件&#x005C;n日付,種別,詳細,教科,向上得点&#x005C;n'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>for</span>(<span class='code_prev_pi'>let</span> <span class='code_prev_bl'>i</span>=<span class='code_prev_db'>0</span>;<span class='code_prev_bl'>i</span>&lt;<span class='code_prev_bl'>data</span>.<span class='code_prev_gr'>table0</span>.<span class='code_prev_gr'>length</span>;<span class='code_prev_bl'>i</span>++){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pi'>let</span> <span class='code_prev_bl'>data_detail</span> = <span class='code_prev_bl'>data</span>.<span class='code_prev_gr'>table0</span>[<span class='code_prev_bl'>i</span>];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_bl'>resultCSV</span> += <span class='code_prev_bl'>data_detail</span>.<span class='code_prev_gr'>DATA_DATE</span>.<span class='code_prev_gr'>split</span>(<span class='code_prev_db'>' '</span>)[<span class='code_prev_bl'>0</span>] + <span class='code_prev_db'>','</span> + <span class='code_prev_bl'>data_detail</span>.<span class='code_prev_gr'>RM_TYPE</span> + <span class='code_prev_db'>','</span> + <span class='code_prev_bl'>data_detail</span>.<span class='code_prev_gr'>KOZA_NM</span> + <span class='code_prev_db'>','</span> + <span class='code_prev_bl'>data_detail</span>.<span class='code_prev_gr'>KYOKA_NM</span> + <span class='code_prev_db'>','</span> + <span class='code_prev_bl'>data_detail</span>.<span class='code_prev_gr'>RM_POINT</span> + <span class='code_prev_db'>'&#x005C;n'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='code_prev_pu'>console</span>.<span class='code_prev_gr'>log</span>(<span class='code_prev_bl'>resultCSV</span>);<br>&nbsp;&nbsp;});<br>}</code>",
  "8$h4":"来校履歴を取得",
  "9$pre":"<code><span class='code_prev_comment'>//2022年当時に書いたコードを紛失してしまったので捜索中...発見したら追記します</span></code>",
  "10$h3":"注意点など",
  "11$h4":"pos.toshin.com以外のページでは取得できません",
  "12$p":"<a href='https://developer.mozilla.org/ja/docs/Web/Security/Same-origin_policy' target='_blank' rel='noopener noreferrer'>同一オリジンポリシー</a>などの関係で、東進トップページ(toshin.com)や確認テスト・修了判定テストのページ(olt.toshin.com)といった、pos.toshin.com以外のドメインのページではデータが取得できません。",
  "13$h4":"(おまけ)来校履歴を遡れる範囲について",
  "14$p":"学力POSの「受講状況・模試成績」上では直近1年までしか確認できませんが、実はそれ以前のデータも取得可能で、<del>東進特有の謎仕様のお陰で</del>なんと江戸時代(1700年代)まで遡ることができます。"
}
